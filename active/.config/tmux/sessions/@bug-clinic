#!/usr/bin/env bash

set -o errtrace
set -o nounset

declare PROJECT_NAME="$(basename $0 | tr -d '@' | tr '.' '-')"
declare PROJECT_CDTO="$(basename $0 | tr -d '@')"

# guard against creating existing sessions.
tmux list-sessions | cut -d: -f1 | grep -E "^$PROJECT_NAME\$" >/dev/null

# proceed if we don't already have a session named per the project.
if [ $? != 0 ]; then
  # create session and add an initial window (detached)
  TMUX= tmux new-session -s $PROJECT_NAME -n editor -d
  tmux send-keys -t $PROJECT_NAME:editor.1 "cd $PROJECT_CDTO ; clear ; bug-clinic" C-m
fi

# attach
if [ ${1-""} != "--no-attach" ]; then
  tmux switch-client -t $PROJECT_NAME:editor
fi
